FROM node:18-alpine
RUN apk add --no-cache wget python3 python3-dev py3-setuptools make g++ sqlite-dev
WORKDIR /app
COPY package*.json ./
RUN npm ci
RUN npm rebuild sqlite3
COPY . .
RUN mkdir -p ./data && chown -R node:node ./data
EXPOSE 3001
HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 CMD wget --no-verbose --tries=1 --spider http://localhost:3001/api/health || exit 1
USER node
CMD ["npm", "run", "dev"]
